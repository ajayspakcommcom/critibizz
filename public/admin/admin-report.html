<html class="openNav">

<head>
    <title>Criti Bizz : Admin Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <script src="js/jquery.min.js"></script>
    <script src="js/common.js"></script>

    <style>
        .table-striped > thead > tr > th:nth-child(1),
        .table-striped > thead > tr > th:nth-child(2),
        .table-striped > thead > tr > th:nth-child(3),
        .table-striped > thead > tr > th:nth-child(4),
        .table-striped > thead > tr > th:nth-child(5),
        .table-striped > thead > tr > th:nth-child(6),
        .table-striped > thead > tr > th:nth-child(7),
        .table-striped > thead > tr > th:nth-child(8),
        .table-striped > thead > tr > th:nth-child(9),
        .table-striped > thead > tr > th:nth-child(10),
        .table-striped > thead > tr > th:nth-child(11),
        .table-striped > thead > tr > th:nth-child(12)
         {
            width: 100px;
        }

        #cmbMonth, #cmbYear, #cmbHosp, #cmbRegion, #cmbActual, #cmbKam, #cmbPotential, #cmbEmpList, #cmbBrandList {
            width: 140px;
        }
    </style>

</head>

<body>
    <div class="primary-nav" id="loadAdminHeader"></div>

    <div class="new-wrapper">
        <div id="main">
            <div id="topnav"></div>
            <div id="main-contents">
                <h1 class="m-b-10"><span id="hospName"></span> </h1>
                <div id="dvEmpDetails"></div>
                <div class="container">
                    <div class="custom-table custom-table-with-border">
                        <div class="zone-profile">
                        </div>
                        <form>

                            <div class="admin-report-header">   
                                <div class="hospital-list-filter">

                                    <div class="form-group">
                                        <select class="form-control" id="cmbMonth">
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">Jun</option>
                                            <option value="7">Jul</option>
                                            <option value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>
                                    </div>
    
                                    <div class="form-group">
                                        <select class="form-control" id="cmbYear">
                                            <option value="2022">2022</option>
                                            <option value="2023">2023</option>
                                        </select>
                                    </div>
    
                                    <div class="form-group">
                                        <select class="form-control" id="cmbHosp">
                                            <option value="">Select Hospital</option>
                                        </select>
                                    </div>
    
                                    <div class="form-group" style="display: none;">
                                        <select class="form-control" id="cmbRegion">
                                            <option value="">Select Region</option>
                                        </select>
                                    </div>
    
                                    <div class="form-group">
                                        <select class="form-control" id="cmbKam">
                                            <option value="">Select Kam</option>
                                        </select>
                                    </div>
    
                                    <div class="form-group">
                                        <select class="form-control" id="cmbBrandList">
                                            <option value="">Select Brand</option>
                                        </select>
                                    </div>
    
    
                                    <div class="form">
                                        <button type="button" onclick="getAdminReport();" class="btn">Go</button>
                                    </div>
    
                                </div>
                                <div>   
                                    <a href="javascript:void(0);" id="exporttoexcell" onclick="downLoadReport()">
                                        <img src="../img/excel.png" alt="export to excel">   
                                    </a>
                                </div>
                            </div>
                        
                            

                        </form>
                        <table class="table table-bordered table-striped grey-box" id="adminReport">
                            <thead>
                                <tr>
                                    <th>Employee Code</th>
                                    <th>Kam</th>
                                    <th>Hospital Name</th>
                                    <th>Thymogam</th>
                                    <th>Amphonex</th>
                                    <th>AG Cuffill</th>
                                    <th>U-Tryp</th>
                                    <th>Octaplex</th>
                                    <th>PolyMxB</th>
                                    <th>Plasmanate</th>
                                    <th>Total Actual</th>
                                </tr>
                            </thead>
                            <tbody id="loadHospitalList">
                                
                            </tbody>
                        </table>
                        <div id="divTotalHospitals"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loader-wrapper none">
        <div class="loader"></div>
    </div>

    <script src="js/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/ionicons@5.1.2/dist/ionicons.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>

    <script src="https://www.jqueryscript.net/demo/Export-Html-Table-To-Excel-Spreadsheet-using-jQuery-table2excel/src/jquery.table2excel.js"></script>
    
    <script src="js/app.js"></script>

    <script>

        function setUpPage() {
            setupTopNav();
            // let urlParams = new URLSearchParams(window.location.search);
            // $('#cmbMonth').val(urlParams.get('mon'));
            // $('#cmbYear').val(urlParams.get('year'));
            // //loadManagers();
            loadMonthYear();
            getReportFilters();
            getAdminReport()
        }
        function getReportFilters() {
            let params = {
                method: 'getAdminReportFilters'
            };
            console.log({ ...params })
            axios
                .get("/admin/api", {
                    params: params
                })
                .then((response) => {
                    let hospitalList = response.data[0],
                        stateList = response.data[1],
                        brandList = response.data[2],
                        kamList = response.data[3],
                        showHtml = [],
                        mon = $('#cmbMonth').val(),
                        year = $('#cmbYear').val();

                        console.log(hospitalList);
                        
                    // LIST HOSPITALS
                    loadComboBox(hospitalList, 'cmbHosp', 'hospitalId', 'hospitalName', 'regionName');
                    // LIST STATE
                    loadComboBox(stateList, 'cmbRegion', 'stateID', 'StateName');
                    //LIST BRANDS
                    loadComboBox(brandList, 'cmbBrandList', 'medId', 'medicineName');
                    //LIST KAMS
                    loadComboBox(kamList, 'cmbKam', 'EmpID', 'firstName', 'Designation');
                });

        }
        
        function getAdminReport() {
            let urlParams = new URLSearchParams(window.location.search);
            $('.loader-wrapper').removeClass('none');
            let param = {
                parentId: 1,
                method: 'getAdminReport',
                mon: $('#cmbMonth').val(),
                year: $('#cmbYear').val(),
                hospitalId: $('#cmbHosp').val(),
                medId: $('#cmbBrandList').val(),
                empId: $('#cmbKam').val(),
            };

            axios
                .post("/admin/api", param)
                .then((response) => {
                    console.log(response.data);
                    let list = response.data,
                        showHtml = [],
                        mon = $('#cmbMonth').val(),
                        year = $('#cmbYear').val();

                    //<td>${camelCaseText(currVal.hospitalName)}</td>
                    list.forEach((item) => {
                        let rowTotal = (parseInt(item.Thymogam) + parseInt(item.Amphonex)+parseInt(item.AGCuffill) + parseInt(item.UTryp)+ parseInt(item.Octaplex)+parseInt(item.PolyMxB) + parseInt(item.Plasmanate))
                        showHtml.push(` <tr>
                          <td>${(item.EmpNumber)}</td>
                          <td>${camelCaseText(item.firstName)}</td>
                          <td>${camelCaseText(item.hospitalName)}</td>
                          <td>${(item.Thymogam)}</td>
                          <td>${(item.Amphonex)}</td>
                          <td>${(item.AGCuffill)}</td>
                          <td>${(item.UTryp)}</td>
                          <td>${(item.Octaplex)}</td>
                          <td>${(item.PolyMxB)}</td>
                          <td>${(item.Plasmanate)}</td>
                          <td>${rowTotal}</td>
                        </tr>   `);
                    });
                    $('#loadHospitalList').html(showHtml.join('')); //
                    $('.loader-wrapper').addClass('none');

                });
        }

      function downLoadReport() {
          debugger;
		$("#adminReport").table2excel({
            exclude:".noExl",
            name:"Worksheet Name",
            filename:"SomeFile",
            fileext:".xls"
        });
	}

        setUpPage();

    </script>

</body>

</html>